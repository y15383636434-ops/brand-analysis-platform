# 🚀 完整测试指南

## 📋 测试前准备

### 1. 确认配置

首先确认LLM API配置正确：

```bash
python scripts/check_llm_config.py
```

应该看到：
```
✅ LLM聚合网关已配置！
```

### 2. 快速API测试

测试API是否可以正常调用：

```bash
python scripts/test_api_quick.py
```

应该看到：
```
✅ API测试成功！
```

## 🎯 测试步骤

### 步骤1：启动服务

**方式1：使用批处理文件（推荐）**

```bash
启动FastAPI.bat
```

**方式2：使用Python命令**

```bash
python app/main.py
```

**方式3：使用uvicorn**

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

启动成功后，您会看到：
```
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### 步骤2：访问Swagger UI

打开浏览器访问：
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### 步骤3：测试品牌管理API

#### 3.1 创建品牌

在Swagger UI中：
1. 找到 `POST /api/v1/brands`
2. 点击 "Try it out"
3. 填写品牌信息：
```json
{
  "name": "测试品牌",
  "description": "这是一个测试品牌",
  "keywords": ["测试", "品牌"],
  "platforms": ["xhs", "douyin"]
}
```
4. 点击 "Execute"
5. 查看响应，应该返回创建的品牌信息

#### 3.2 获取品牌列表

1. 找到 `GET /api/v1/brands`
2. 点击 "Try it out"
3. 点击 "Execute"
4. 应该看到刚才创建的品牌

### 步骤4：测试数据采集

#### 4.1 启动爬虫任务

1. 找到 `POST /api/v1/brands/{brand_id}/crawl`
2. 点击 "Try it out"
3. 输入品牌ID（从步骤3.1获取）
4. 填写爬虫参数：
```json
{
  "platforms": ["xhs"],
  "keywords": ["测试"],
  "max_items": 10,
  "include_comments": false
}
```
5. 点击 "Execute"
6. 查看任务ID

#### 4.2 查看任务状态

1. 找到 `GET /api/v1/crawl-tasks`
2. 点击 "Try it out"
3. 输入任务ID
4. 点击 "Execute"
5. 查看任务状态和进度

### 步骤5：测试AI分析

#### 5.1 启动分析任务

1. 找到 `POST /api/v1/brands/{brand_id}/analyze`
2. 点击 "Try it out"
3. 输入品牌ID
4. 填写分析参数：
```json
{
  "analysis_type": "full",
  "include_sentiment": true,
  "include_topics": true,
  "include_keywords": true,
  "include_insights": true
}
```
5. 点击 "Execute"
6. 查看任务ID

#### 5.2 查看分析结果

1. 找到 `GET /api/v1/brands/{brand_id}/analysis`
2. 点击 "Try it out"
3. 输入品牌ID
4. 点击 "Execute"
5. 查看分析结果，应该包含：
   - 情感分析
   - 关键词提取
   - 主题分析
   - LLM深度洞察

### 步骤6：测试Web界面

访问统一控制台：
- **Dashboard**: http://localhost:8000/api/v1/dashboard

这里可以：
- 查看品牌列表
- 启动爬虫任务
- 查看分析结果
- 管理数据

## 🔍 功能测试清单

### ✅ 基础功能测试

- [ ] 服务启动成功
- [ ] Swagger UI可以访问
- [ ] 健康检查正常（http://localhost:8000/health）

### ✅ 品牌管理测试

- [ ] 创建品牌成功
- [ ] 获取品牌列表成功
- [ ] 获取品牌详情成功
- [ ] 更新品牌成功
- [ ] 删除品牌成功

### ✅ 数据采集测试

- [ ] 启动爬虫任务成功
- [ ] 查看任务状态成功
- [ ] 任务可以正常执行
- [ ] 数据可以正常保存

### ✅ AI分析测试

- [ ] 启动分析任务成功
- [ ] 情感分析功能正常
- [ ] 关键词提取功能正常
- [ ] LLM深度分析功能正常
- [ ] 分析结果可以正常查看

### ✅ 报告生成测试

- [ ] 生成报告成功
- [ ] 报告可以正常下载
- [ ] 报告内容正确

## 🐛 常见问题

### Q1: 服务启动失败

**检查：**
1. 端口8000是否被占用
2. 数据库连接是否正常
3. 查看日志文件：`logs/app.log`

**解决：**
```bash
# 检查端口占用
netstat -ano | findstr :8000

# 查看日志
type logs\app.log
```

### Q2: API调用失败

**检查：**
1. LLM API配置是否正确
2. 运行：`python scripts/test_api_quick.py`

**解决：**
```bash
# 重新测试API
python scripts/test_llm_api.py

# 检查配置
python scripts/check_llm_config.py
```

### Q3: 爬虫任务失败

**检查：**
1. MediaCrawler路径是否正确
2. 平台登录状态是否正常
3. 查看任务错误信息

**解决：**
- 检查 `.env` 文件中的 `MEDIACRAWLER_PATH`
- 在管理台查看任务详情

### Q4: AI分析失败

**检查：**
1. LLM API是否正常
2. 是否有足够的数据进行分析
3. 查看分析任务错误信息

**解决：**
```bash
# 测试LLM API
python scripts/test_api_quick.py

# 检查可用模型
python scripts/list_available_models.py
```

## 📊 性能测试

### 测试并发请求

使用工具如 `curl` 或 Postman 测试并发请求：

```bash
# 测试健康检查
curl http://localhost:8000/health

# 测试品牌列表
curl http://localhost:8000/api/v1/brands
```

### 测试大数据量

1. 创建多个品牌
2. 启动多个爬虫任务
3. 测试批量分析
4. 观察系统性能

## 🎉 测试完成

完成所有测试后，您应该能够：
- ✅ 正常使用品牌管理功能
- ✅ 正常采集数据
- ✅ 正常进行AI分析
- ✅ 正常生成报告

## 📚 相关文档

- [API设计文档](docs/api_design.md)
- [项目架构文档](项目架构文档.md)
- [使用指南](docs/使用指南.md)
- [测试API配置](测试API配置.md)

---

**提示**：如果遇到问题，请查看日志文件或运行诊断脚本。


