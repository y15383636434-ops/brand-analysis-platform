# 🧪 平台爬取测试说明

## 📋 测试概述

本说明文档介绍如何测试每个平台的MediaCrawler爬取功能，并确保Web界面正常工作。

---

## 🚀 测试方法

### 方法1: 直接测试MediaCrawler（推荐）

使用 `test_all_platforms_crawler.py` 脚本直接测试MediaCrawler的爬取功能：

```bash
python test_all_platforms_crawler.py
```

**功能**：
- 测试每个平台的MediaCrawler爬取功能
- 自动设置和恢复配置
- 检查数据文件是否生成
- 显示测试结果汇总

**使用步骤**：
1. 运行脚本
2. 选择要测试的平台（或测试所有平台）
3. 选择是否测试评论功能
4. 等待测试完成

**注意事项**：
- 首次使用需要扫码登录（会自动保存登录状态）
- 测试使用较小的爬取数量（5条）以加快速度
- 每个平台测试完成后会恢复配置

---

### 方法2: 测试Web界面API

使用 `test_web_crawler.py` 脚本测试Web界面的API调用：

```bash
# 确保FastAPI服务正在运行
python -m uvicorn app.main:app --reload

# 在另一个终端运行测试脚本
python test_web_crawler.py
```

**功能**：
- 测试Web界面的API调用
- 验证平台代码映射是否正确
- 检查API响应是否正常

**使用步骤**：
1. 启动FastAPI服务
2. 运行测试脚本
3. 选择要测试的平台（或测试所有平台）
4. 查看测试结果

---

### 方法3: 手动Web界面测试

通过浏览器访问Web界面进行手动测试：

1. **启动服务**
   ```bash
   python -m uvicorn app.main:app --reload
   ```

2. **访问界面**
   - 打开浏览器访问: http://localhost:8000/api/v1/mediacrawler

3. **测试步骤**
   - 选择平台
   - 输入关键词
   - 设置最大数量（建议先设置5-10条测试）
   - 选择笔记类型（仅小红书支持）
   - 选择评论选项
   - 点击"开始爬取"

4. **查看结果**
   - 查看终端窗口了解爬取进度
   - 访问数据查看器查看爬取的数据

---

## 📊 平台支持情况

### 平台代码映射

| Web界面代码 | MediaCrawler代码 | 平台名称 | 支持笔记类型 | 支持评论 |
|------------|-----------------|---------|------------|---------|
| xhs | xhs | 小红书 | ✅ | ✅ |
| douyin | dy | 抖音 | ❌ | ✅ |
| weibo | wb | 微博 | ❌ | ✅ |
| zhihu | zhihu | 知乎 | ❌ | ✅ |
| bilibili | bili | B站 | ❌ | ✅ |
| kuaishou | ks | 快手 | ❌ | ✅ |
| tieba | tieba | 百度贴吧 | ❌ | ✅ |

### 平台特性

- **笔记类型选择**: 仅小红书支持（全部/视频/图文）
- **评论功能**: 所有平台都支持
- **二级评论**: 所有平台都支持（需要先开启一级评论）

---

## 🔍 测试检查清单

### 基础功能测试

- [ ] 服务启动正常
- [ ] Web界面可以访问
- [ ] 平台选择下拉框正常
- [ ] 关键词输入正常
- [ ] 最大数量设置正常

### 平台功能测试

- [ ] 小红书爬取正常
- [ ] 抖音爬取正常
- [ ] 微博爬取正常
- [ ] 知乎爬取正常
- [ ] B站爬取正常
- [ ] 快手爬取正常
- [ ] 百度贴吧爬取正常

### 功能特性测试

- [ ] 笔记类型选择（小红书）
- [ ] 一级评论爬取
- [ ] 二级评论爬取
- [ ] 数据文件生成
- [ ] JSON数据查看

### 错误处理测试

- [ ] 无效平台代码处理
- [ ] 空关键词处理
- [ ] 服务未启动处理
- [ ] MediaCrawler目录不存在处理

---

## 🐛 常见问题

### Q1: 平台代码不匹配？

A: 检查 `app/api/v1/mediacrawler_ui.py` 中的 `MEDIACRAWLER_PLATFORM_MAP` 映射是否正确。

### Q2: 笔记类型选项显示错误？

A: 检查 `PLATFORM_FEATURES` 配置，确保小红书设置了 `supports_note_type: True`。

### Q3: 爬取任务启动失败？

A: 检查：
- MediaCrawler目录是否存在
- main.py文件是否存在
- Python环境是否正确

### Q4: 数据文件未生成？

A: 检查：
- MediaCrawler是否正常执行
- 数据目录权限是否正确
- 查看终端日志了解错误信息

---

## 📝 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: XXX

平台测试结果:
- 小红书 (xhs): ✅/❌
- 抖音 (douyin): ✅/❌
- 微博 (weibo): ✅/❌
- 知乎 (zhihu): ✅/❌
- B站 (bilibili): ✅/❌
- 快手 (kuaishou): ✅/❌
- 百度贴吧 (tieba): ✅/❌

功能测试结果:
- 笔记类型选择: ✅/❌
- 评论爬取: ✅/❌
- 数据查看: ✅/❌

问题记录:
1. ...
2. ...
```

---

## ✅ 测试完成标准

1. **所有平台都能正常启动爬取任务**
2. **平台代码映射正确**
3. **笔记类型选项正确显示/隐藏**
4. **数据文件正常生成**
5. **Web界面功能正常**

---

**现在可以开始测试各个平台的爬取功能了！** 🎉






