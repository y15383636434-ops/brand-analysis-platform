<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®é‡‡é›†ä¸åˆ†æå¹³å° - ç»Ÿä¸€æ§åˆ¶å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            overflow-x: hidden;
        }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }
        
        .sidebar-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .nav-menu {
            list-style: none;
            padding: 0;
        }
        
        .nav-item {
            margin: 5px 0;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .nav-link.active {
            background: rgba(255,255,255,0.2);
            border-left-color: white;
            color: white;
            font-weight: 500;
        }
        
        .nav-link i {
            margin-right: 12px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        
        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            padding: 20px;
            transition: margin-left 0.3s;
        }
        
        .content-header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-header h2 {
            color: #333;
            font-size: 24px;
            font-weight: 600;
        }
        
        .content-body {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            min-height: calc(100vh - 120px);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: #667eea;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 20px;
            }
        }
        
        .mobile-menu-btn {
            display: none;
        }
        
        /* éšè—æ‰€æœ‰å†…å®¹é¢æ¿ */
        .content-panel {
            display: none;
        }
        
        .content-panel.active {
            display: block;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
    
    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>ğŸ“Š æ•°æ®å¹³å°</h1>
            <p>ç»Ÿä¸€æ§åˆ¶å°</p>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link active" onclick="loadModuleWithIframe('mediacrawler', this)">
                    <span>ğŸ•·ï¸</span>
                    <span>MediaCrawlerçˆ¬è™«</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="loadModuleWithIframe('monitor', this)">
                    <span>ğŸ“Š</span>
                    <span>çˆ¬å–ç›‘æ§</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="loadModuleWithIframe('json-viewer', this)">
                    <span>ğŸ“„</span>
                    <span>JSONæ•°æ®æŸ¥çœ‹</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="loadModuleWithIframe('data-analysis', this)">
                    <span>ğŸ”</span>
                    <span>æ•°æ®åˆ†æ</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="loadModuleWithIframe('data-display', this)">
                    <span>ğŸ“ˆ</span>
                    <span>æ•°æ®å±•ç¤º</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="loadModuleWithIframe('brands', this)">
                    <span>ğŸ¢</span>
                    <span>å“ç‰Œç®¡ç†</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="loadModuleWithIframe('crawler', this)">
                    <span>ğŸ”„</span>
                    <span>çˆ¬è™«æ§åˆ¶</span>
                </a>
            </li>
        </ul>
    </div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <div class="content-header">
            <h2 id="pageTitle">MediaCrawlerçˆ¬è™«æ§åˆ¶å°</h2>
            <div id="headerActions"></div>
        </div>
        <div class="content-body">
            <div id="contentContainer">
                <div class="loading">æ­£åœ¨åŠ è½½...</div>
            </div>
        </div>
    </div>
    
    <script>
        let currentModule = 'mediacrawler';
        
        // åˆ‡æ¢ä¾§è¾¹æ ï¼ˆç§»åŠ¨ç«¯ï¼‰
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }
        
        // åŠ è½½æ¨¡å—
        async function loadModule(moduleName) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('.nav-link').classList.add('active');
            
            // æ›´æ–°å½“å‰æ¨¡å—
            currentModule = moduleName;
            
            // æ›´æ–°æ ‡é¢˜
            const titles = {
                'mediacrawler': 'MediaCrawlerçˆ¬è™«æ§åˆ¶å°',
                'monitor': 'çˆ¬å–ä»»åŠ¡ç›‘æ§',
                'json-viewer': 'JSONæ•°æ®æŸ¥çœ‹å™¨',
                'data-analysis': 'æ•°æ®åˆ†æ',
                'data-display': 'æ•°æ®å±•ç¤º',
                'brands': 'å“ç‰Œç®¡ç†',
                'crawler': 'çˆ¬è™«æ§åˆ¶'
            };
            document.getElementById('pageTitle').textContent = titles[moduleName] || 'æ§åˆ¶å°';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const container = document.getElementById('contentContainer');
            container.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½...</div>';
            
            // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
            
            try {
                // æ ¹æ®æ¨¡å—åŠ è½½ä¸åŒçš„å†…å®¹
                let url = '';
                switch(moduleName) {
                    case 'mediacrawler':
                        url = '/api/v1/mediacrawler';
                        break;
                    case 'monitor':
                        url = '/api/v1/mediacrawler/monitor';
                        break;
                    case 'json-viewer':
                        url = '/api/v1/mediacrawler/data';
                        break;
                    case 'data-analysis':
                        url = '/api/v1/data-analysis';
                        break;
                    case 'data-display':
                        url = '/api/v1/data';
                        break;
                    case 'brands':
                        url = '/api/v1/brands';
                        break;
                    case 'crawler':
                        url = '/api/v1/crawler';
                        break;
                    default:
                        container.innerHTML = '<div class="empty-state"><h3>æœªçŸ¥æ¨¡å—</h3><p>è¯·é€‰æ‹©æ­£ç¡®çš„åŠŸèƒ½æ¨¡å—</p></div>';
                        return;
                }
                
                // ä½¿ç”¨fetchè·å–HTMLå†…å®¹
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const html = await response.text();
                
                // æå–bodyå†…å®¹ï¼ˆç§»é™¤åŸé¡µé¢çš„bodyæ ‡ç­¾å’Œæ ·å¼ï¼Œåªä¿ç•™å†…å®¹ï¼‰
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // è·å–bodyå†…å®¹
                const bodyContent = doc.body;
                
                // æå–æ ·å¼ï¼ˆå¦‚æœéœ€è¦ä¿ç•™åŸé¡µé¢æ ·å¼ï¼‰
                const styles = doc.querySelectorAll('style');
                let styleContent = '';
                styles.forEach(style => {
                    styleContent += style.textContent + '\n';
                });
                
                // åˆ›å»ºæ–°çš„å®¹å™¨
                const newContainer = document.createElement('div');
                newContainer.className = 'module-content';
                
                // å¦‚æœæœ‰æ ·å¼ï¼Œæ·»åŠ åˆ°head
                if (styleContent) {
                    const styleTag = document.createElement('style');
                    styleTag.textContent = styleContent;
                    // ä¸ºäº†é¿å…æ ·å¼å†²çªï¼Œç»™æ ·å¼æ·»åŠ ä½œç”¨åŸŸ
                    styleTag.textContent = styleContent.replace(/([^{}]+){/g, (match, selector) => {
                        // ä¸ºé€‰æ‹©å™¨æ·»åŠ ä½œç”¨åŸŸ
                        return `.module-content ${selector.trim()}{`;
                    });
                    document.head.appendChild(styleTag);
                }
                
                // å¤åˆ¶bodyå†…å®¹ï¼ˆæ’é™¤scriptæ ‡ç­¾ï¼Œç¨åå•ç‹¬å¤„ç†ï¼‰
                const scripts = [];
                bodyContent.querySelectorAll('script').forEach(script => {
                    scripts.push(script.textContent);
                    script.remove();
                });
                
                newContainer.innerHTML = bodyContent.innerHTML;
                
                // æ›¿æ¢å®¹å™¨å†…å®¹
                container.innerHTML = '';
                container.appendChild(newContainer);
                
                // æ‰§è¡Œè„šæœ¬
                scripts.forEach(scriptText => {
                    try {
                        // åˆ›å»ºæ–°çš„å‡½æ•°ä½œç”¨åŸŸæ‰§è¡Œè„šæœ¬
                        const script = document.createElement('script');
                        script.textContent = scriptText;
                        container.appendChild(script);
                    } catch (e) {
                        console.error('æ‰§è¡Œè„šæœ¬å¤±è´¥:', e);
                    }
                });
                
                // è°ƒæ•´iframeå†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰
                const iframes = container.querySelectorAll('iframe');
                iframes.forEach(iframe => {
                    iframe.style.width = '100%';
                    iframe.style.height = '600px';
                    iframe.style.border = 'none';
                });
                
            } catch (error) {
                console.error('åŠ è½½æ¨¡å—å¤±è´¥:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>åŠ è½½å¤±è´¥</h3>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        <p style="margin-top: 20px;">
                            <button onclick="loadModule('${moduleName}')" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                é‡è¯•
                            </button>
                        </p>
                    </div>
                `;
            }
        }
        
        // ä½¿ç”¨iframeæ–¹å¼åŠ è½½ï¼ˆæ›´ç®€å•å¯é ï¼‰
        function loadModuleWithIframe(moduleName, eventElement) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            let clickedLink = null;
            if (eventElement) {
                clickedLink = eventElement.closest('.nav-link');
            } else {
                // å¦‚æœæ²¡æœ‰ä¼ å…¥å…ƒç´ ï¼Œæ ¹æ®æ¨¡å—åæŸ¥æ‰¾å¯¹åº”çš„é“¾æ¥
                clickedLink = document.querySelector(`.nav-link[onclick*="${moduleName}"]`);
            }
            
            if (clickedLink) {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                clickedLink.classList.add('active');
            }
            
            currentModule = moduleName;
            
            const titles = {
                'mediacrawler': 'MediaCrawlerçˆ¬è™«æ§åˆ¶å°',
                'monitor': 'çˆ¬å–ä»»åŠ¡ç›‘æ§',
                'json-viewer': 'JSONæ•°æ®æŸ¥çœ‹å™¨',
                'data-analysis': 'æ•°æ®åˆ†æ',
                'data-display': 'æ•°æ®å±•ç¤º',
                'brands': 'å“ç‰Œç®¡ç†',
                'crawler': 'çˆ¬è™«æ§åˆ¶'
            };
            document.getElementById('pageTitle').textContent = titles[moduleName] || 'æ§åˆ¶å°';
            
            const container = document.getElementById('contentContainer');
            
            let url = '';
            switch(moduleName) {
                case 'mediacrawler':
                    url = '/api/v1/mediacrawler';
                    break;
                case 'monitor':
                    url = '/api/v1/mediacrawler/monitor';
                    break;
                case 'json-viewer':
                    url = '/api/v1/mediacrawler/data';
                    break;
                case 'data-analysis':
                    url = '/api/v1/data-analysis';
                    break;
                case 'data-display':
                    url = '/api/v1/data';
                    break;
                case 'brands':
                    url = '/api/v1/brands/page';
                    break;
                case 'crawler':
                    url = '/api/v1/crawler';
                    break;
                default:
                    container.innerHTML = '<div class="empty-state"><h3>æœªçŸ¥æ¨¡å—</h3><p>è¯·é€‰æ‹©æ­£ç¡®çš„åŠŸèƒ½æ¨¡å—</p></div>';
                    return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            container.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½æ¨¡å—...</div>';
            
            // åˆ›å»ºiframe
            const iframe = document.createElement('iframe');
            iframe.id = 'moduleIframe';
            iframe.src = url;
            iframe.style.cssText = 'width: 100%; height: calc(100vh - 200px); border: none; border-radius: 10px; background: white;';
            iframe.onload = function() {
                console.log('æ¨¡å—åŠ è½½å®Œæˆ:', moduleName);
                try {
                    // å°è¯•è°ƒæ•´iframeå†…å®¹çš„é«˜åº¦ï¼ˆå¦‚æœå†…å®¹å…è®¸ï¼‰
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    if (iframeDoc) {
                        const body = iframeDoc.body;
                        if (body) {
                            // ç§»é™¤åŸé¡µé¢çš„paddingï¼Œè®©å†…å®¹å¡«æ»¡iframe
                            body.style.margin = '0';
                            body.style.padding = '0';
                        }
                    }
                } catch (e) {
                    // è·¨åŸŸé™åˆ¶ï¼Œæ— æ³•è®¿é—®iframeå†…å®¹ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰
                    console.log('æ— æ³•è®¿é—®iframeå†…å®¹ï¼ˆè·¨åŸŸé™åˆ¶ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰');
                }
            };
            iframe.onerror = function() {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>åŠ è½½å¤±è´¥</h3>
                        <p>æ— æ³•åŠ è½½æ¨¡å—: ${moduleName}</p>
                        <p style="margin-top: 20px;">
                            <button onclick="loadModuleWithIframe('${moduleName}')" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                é‡è¯•
                            </button>
                        </p>
                    </div>
                `;
            };
            
            // å»¶è¿Ÿä¸€ç‚¹å†è®¾ç½®iframeï¼Œè®©åŠ è½½çŠ¶æ€æ˜¾ç¤ºä¸€ä¸‹
            setTimeout(() => {
                container.innerHTML = '';
                container.appendChild(iframe);
            }, 100);
            
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }
        
        // åˆå§‹åŒ–ï¼šåŠ è½½é»˜è®¤æ¨¡å—
        window.addEventListener('DOMContentLoaded', function() {
            // ä½¿ç”¨iframeæ–¹å¼åŠ è½½ï¼ˆæ›´å¯é ï¼‰
            loadModuleWithIframe('mediacrawler');
        });
        
        // å¯¼å‡ºå‡½æ•°ä¾›å…¨å±€ä½¿ç”¨
        window.loadModuleWithIframe = loadModuleWithIframe;
    </script>
</body>
</html>

