<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ¬å–æ•°æ®å±•ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .header-info {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-item strong {
            color: #666;
        }
        
        .filters {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-group label {
            color: #666;
            font-weight: 500;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 8px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5568d3;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .data-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .platform-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .platform-xhs { background: #ff2442; color: white; }
        .platform-douyin { background: #000; color: white; }
        .platform-weibo { background: #e6162d; color: white; }
        .platform-zhihu { background: #0084ff; color: white; }
        .platform-bilibili { background: #fb7299; color: white; }
        .platform-kuaishou { background: #ff6600; color: white; }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-content {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-author {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #999;
        }
        
        .author-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .card-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #999;
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .card-images {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .card-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #999;
        }
        
        .card-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .card-link:hover {
            text-decoration: underline;
        }
        
        .pagination {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .pagination button:hover:not(:disabled) {
            border-color: #667eea;
            color: #667eea;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination .current {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .empty {
            text-align: center;
            padding: 60px;
            color: #999;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-close:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š çˆ¬å–æ•°æ®å±•ç¤º</h1>
            <div class="header-info" id="headerInfo">
                <div class="info-item">
                    <strong>å“ç‰Œ:</strong>
                    <span id="brandName">åŠ è½½ä¸­...</span>
                </div>
                <div class="info-item">
                    <strong>æ€»æ•°æ®:</strong>
                    <span id="totalCount">0</span> æ¡
                </div>
                <div class="info-item">
                    <strong>å½“å‰å¹³å°:</strong>
                    <span id="currentPlatform">å…¨éƒ¨</span>
                </div>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label>å¹³å°ç­›é€‰:</label>
                <select id="platformFilter">
                    <option value="">å…¨éƒ¨å¹³å°</option>
                    <option value="xhs">å°çº¢ä¹¦</option>
                    <option value="douyin">æŠ–éŸ³</option>
                    <option value="weibo">å¾®åš</option>
                    <option value="zhihu">çŸ¥ä¹</option>
                    <option value="bilibili">Bç«™</option>
                    <option value="kuaishou">å¿«æ‰‹</option>
                </select>
            </div>
            <div class="filter-group">
                <label>æ¯é¡µæ˜¾ç¤º:</label>
                <select id="pageSize">
                    <option value="12">12æ¡</option>
                    <option value="24" selected>24æ¡</option>
                    <option value="48">48æ¡</option>
                </select>
            </div>
            <button class="btn" onclick="loadData()">åˆ·æ–°æ•°æ®</button>
        </div>
        
        <div id="dataContainer" class="loading">åŠ è½½ä¸­...</div>
        
        <div class="pagination" id="pagination"></div>
    </div>
    
    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">æ•°æ®è¯¦æƒ…</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let brandId = urlParams.get('brand_id') || null;
        let currentPlatform = urlParams.get('platform') || '';
        let currentPage = parseInt(urlParams.get('page') || '1');
        let pageSize = 24;
        let totalPages = 1;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            if (brandId) {
                document.getElementById('platformFilter').value = currentPlatform;
                loadData();
            } else {
                document.getElementById('dataContainer').innerHTML = 
                    '<div class="empty"><div class="empty-icon">ğŸ“­</div><p>è¯·å…ˆé€‰æ‹©å“ç‰ŒæŸ¥çœ‹æ•°æ®</p><p><a href="/api/v1/brands" style="color: #667eea;">æŸ¥çœ‹å“ç‰Œåˆ—è¡¨</a></p></div>';
            }
            
            document.getElementById('platformFilter').addEventListener('change', function() {
                currentPlatform = this.value;
                currentPage = 1;
                updateURL();
                loadData();
            });
            
            document.getElementById('pageSize').addEventListener('change', function() {
                pageSize = parseInt(this.value);
                currentPage = 1;
                loadData();
            });
        });
        
        function updateURL() {
            const params = new URLSearchParams();
            if (brandId) params.set('brand_id', brandId);
            if (currentPlatform) params.set('platform', currentPlatform);
            if (currentPage > 1) params.set('page', currentPage);
            window.history.pushState({}, '', '?' + params.toString());
        }
        
        async function loadData() {
            if (!brandId) return;
            
            document.getElementById('dataContainer').innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                // åŠ è½½ç»Ÿè®¡æ•°æ®
                const statsResponse = await fetch(`/api/v1/brands/${brandId}/data/stats`);
                const statsData = await statsResponse.json();
                
                if (statsData.code === 200) {
                    const stats = statsData.data;
                    document.getElementById('brandName').textContent = stats.brand_name;
                    document.getElementById('totalCount').textContent = stats.total;
                    
                    const platformName = currentPlatform ? 
                        getPlatformName(currentPlatform) : 'å…¨éƒ¨';
                    document.getElementById('currentPlatform').textContent = platformName;
                }
                
                // åŠ è½½æ•°æ®åˆ—è¡¨
                const params = new URLSearchParams({
                    page: currentPage,
                    page_size: pageSize
                });
                if (currentPlatform) params.set('platform', currentPlatform);
                
                const response = await fetch(`/api/v1/brands/${brandId}/data?${params}`);
                const data = await response.json();
                
                if (data.code === 200) {
                    displayData(data.data);
                    totalPages = Math.ceil(data.data.total / pageSize);
                    updatePagination();
                } else {
                    document.getElementById('dataContainer').innerHTML = 
                        '<div class="empty"><div class="empty-icon">âŒ</div><p>åŠ è½½å¤±è´¥: ' + data.message + '</p></div>';
                }
            } catch (error) {
                document.getElementById('dataContainer').innerHTML = 
                    '<div class="empty"><div class="empty-icon">âŒ</div><p>åŠ è½½å¤±è´¥: ' + error.message + '</p></div>';
            }
        }
        
        function displayData(data) {
            if (!data.items || data.items.length === 0) {
                document.getElementById('dataContainer').innerHTML = 
                    '<div class="empty"><div class="empty-icon">ğŸ“­</div><p>æš‚æ— æ•°æ®</p></div>';
                return;
            }
            
            const grid = document.createElement('div');
            grid.className = 'data-grid';
            
            data.items.forEach(item => {
                const card = createDataCard(item);
                grid.appendChild(card);
            });
            
            document.getElementById('dataContainer').innerHTML = '';
            document.getElementById('dataContainer').appendChild(grid);
        }
        
        function createDataCard(item) {
            const card = document.createElement('div');
            card.className = 'data-card';
            
            const platform = item.platform || 'unknown';
            const platformName = getPlatformName(platform);
            
            const title = item.title || item.content?.substring(0, 50) || 'æ— æ ‡é¢˜';
            const content = item.content || '';
            const author = item.author || {};
            const engagement = item.engagement || {};
            const images = item.media?.images || [];
            const publishTime = item.publish_time || item.crawled_at || '';
            
            card.innerHTML = `
                <div class="card-header">
                    <span class="platform-badge platform-${platform}">${platformName}</span>
                    <span style="font-size: 12px; color: #999;">${formatTime(publishTime)}</span>
                </div>
                <div class="card-title">${title}</div>
                ${content ? `<div class="card-content">${content}</div>` : ''}
                ${author.name ? `
                    <div class="card-author">
                        ${author.avatar ? `<img src="${author.avatar}" alt="${author.name}" class="author-avatar" onerror="this.style.display='none'">` : ''}
                        <span>${author.name}</span>
                    </div>
                ` : ''}
                ${images.length > 0 ? `
                    <div class="card-images">
                        ${images.slice(0, 4).map(img => 
                            `<img src="${img}" alt="å›¾ç‰‡" class="card-image" onclick="showImage('${img}')" onerror="this.style.display='none'">`
                        ).join('')}
                    </div>
                ` : ''}
                <div class="card-stats">
                    <div class="stat-item">ğŸ‘ ${engagement.likes || 0}</div>
                    <div class="stat-item">ğŸ’¬ ${engagement.comments || 0}</div>
                    <div class="stat-item">ğŸ”„ ${engagement.shares || 0}</div>
                </div>
                <div class="card-footer">
                    <a href="#" class="card-link" onclick="showDetail(event, ${JSON.stringify(item).replace(/"/g, '&quot;')})">æŸ¥çœ‹è¯¦æƒ…</a>
                    ${item.url ? `<a href="${item.url}" target="_blank" class="card-link">åŸé“¾æ¥</a>` : ''}
                </div>
            `;
            
            return card;
        }
        
        function showDetail(event, item) {
            event.preventDefault();
            const modal = document.getElementById('detailModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = item.title || 'æ•°æ®è¯¦æƒ…';
            
            const platform = item.platform || 'unknown';
            const platformName = getPlatformName(platform);
            
            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <span class="platform-badge platform-${platform}">${platformName}</span>
                    <span style="margin-left: 10px; color: #999; font-size: 14px;">${formatTime(item.publish_time || item.crawled_at)}</span>
                </div>
                ${item.content ? `<div style="margin-bottom: 20px; line-height: 1.8; color: #333;">${item.content}</div>` : ''}
                ${item.author ? `
                    <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        ${item.author.avatar ? `<img src="${item.author.avatar}" alt="${item.author.name}" style="width: 40px; height: 40px; border-radius: 50%;" onerror="this.style.display='none'">` : ''}
                        <div>
                            <div style="font-weight: 600;">${item.author.name || 'æœªçŸ¥'}</div>
                            ${item.author.id ? `<div style="font-size: 12px; color: #999;">ID: ${item.author.id}</div>` : ''}
                        </div>
                    </div>
                ` : ''}
                ${item.media?.images?.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 600; margin-bottom: 10px;">å›¾ç‰‡ (${item.media.images.length}å¼ )</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                            ${item.media.images.map(img => 
                                `<img src="${img}" alt="å›¾ç‰‡" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; cursor: pointer;" onclick="showImage('${img}')" onerror="this.style.display='none'">`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
                <div style="margin-bottom: 20px; display: flex; gap: 30px;">
                    <div><strong>ç‚¹èµ:</strong> ${item.engagement?.likes || 0}</div>
                    <div><strong>è¯„è®º:</strong> ${item.engagement?.comments || 0}</div>
                    <div><strong>åˆ†äº«:</strong> ${item.engagement?.shares || 0}</div>
                    ${item.engagement?.collections ? `<div><strong>æ”¶è—:</strong> ${item.engagement.collections}</div>` : ''}
                </div>
                ${item.url ? `<div><a href="${item.url}" target="_blank" style="color: #667eea;">æŸ¥çœ‹åŸæ–‡</a></div>` : ''}
            `;
            
            modal.classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('detailModal').classList.remove('show');
        }
        
        function showImage(url) {
            window.open(url, '_blank');
        }
        
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // ä¸Šä¸€é¡µ
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'ä¸Šä¸€é¡µ';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateURL();
                    loadData();
                }
            };
            pagination.appendChild(prevBtn);
            
            // é¡µç 
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.textContent = '1';
                firstBtn.onclick = () => {
                    currentPage = 1;
                    updateURL();
                    loadData();
                };
                pagination.appendChild(firstBtn);
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                if (i === currentPage) {
                    pageBtn.className = 'current';
                }
                pageBtn.onclick = () => {
                    currentPage = i;
                    updateURL();
                    loadData();
                };
                pagination.appendChild(pageBtn);
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }
                const lastBtn = document.createElement('button');
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => {
                    currentPage = totalPages;
                    updateURL();
                    loadData();
                };
                pagination.appendChild(lastBtn);
            }
            
            // ä¸‹ä¸€é¡µ
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateURL();
                    loadData();
                }
            };
            pagination.appendChild(nextBtn);
        }
        
        function getPlatformName(platform) {
            const names = {
                'xhs': 'å°çº¢ä¹¦',
                'douyin': 'æŠ–éŸ³',
                'weibo': 'å¾®åš',
                'zhihu': 'çŸ¥ä¹',
                'bilibili': 'Bç«™',
                'kuaishou': 'å¿«æ‰‹'
            };
            return names[platform] || platform;
        }
        
        function formatTime(timeStr) {
            if (!timeStr) return '';
            const date = new Date(timeStr);
            return date.toLocaleString('zh-CN');
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>






